<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù†Ø§ÙØ°Ø© ÙØ§ØªÙŠ â€” Ù‡Ø¯ÙŠØ© Ø®Ø§Ù„Ø¯</title>

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>

  <style>
    :root{
      --teal:#1a535c;           
      --gold:#ffcb69;           
      --fassi:#002e5d;          
      --rose:#c06c84;           
      --sand:#e8c39e;           
      --ink:#0f1c2b;            
      --deep-purple:#4b0082;    
      --light:#fffaf3;
      --text:#eaeaea;
      --blur:14px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family:'Tajawal',sans-serif;
      color:var(--text);
      min-height:100vh;
      display:flex;align-items:center;justify-content:center;
      background: radial-gradient(1200px 600px at 80% 10%, rgba(255,203,105,.18), transparent 55%),
                  linear-gradient(135deg, var(--ink) 0%, var(--fassi) 100%);
      perspective:1000px;
      overflow: hidden; /* ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
    }

    .bg-layer{
      position:fixed;inset:0;z-index:0;pointer-events:none;
      background:linear-gradient(135deg, var(--fassi), var(--teal));
      opacity:.18;mix-blend-mode:screen;
      transition:opacity .8s ease, filter 1.2s ease, background 1s ease;
      filter:saturate(1.05) contrast(1.05);
    }
    #particles-js{
      position:fixed;inset:0;z-index:1;background:transparent;opacity:.9;
    }
    
    /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ (Overlay) Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
    #start-overlay {
        position: fixed;
        inset: 0;
        z-index: 9999; /* Ø£Ø¹Ù„Ù‰ Ù…Ù† ÙƒÙ„ Ø´ÙŠØ¡ */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at 50% 50%, rgba(15, 28, 43, 0.95), rgba(0, 46, 93, 0.98));
        opacity: 1;
        transition: opacity 1.2s ease-out, visibility 1.2s ease-out;
        visibility: visible;
        text-align: center;
        backdrop-filter: blur(2px);
    }
    #start-overlay.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
    }
    #start-overlay h2 {
        font-size: 44px;
        color: var(--gold);
        margin-bottom: 10px;
        text-shadow: 0 0 15px rgba(255,203,105,.8);
        font-weight: 800;
        animation: pulse 2s infinite;
    }
    #start-overlay p {
        font-size: 18px;
        color: var(--light);
        opacity: 0.8;
        margin-bottom: 40px;
    }
    /* Ø²Ø± Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ù„Ù‡ ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„ØªÙ…ÙŠÙŠØ²Ù‡ */
    #startBtn {
        font-size: 20px;
        padding: 16px 36px;
        animation: sparkButton 1.5s ease-in-out infinite alternate;
        box-shadow: 0 0 20px rgba(255,203,105,.8), 0 0 40px rgba(255,160,117,.5);
    }
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.02); }
        100% { transform: scale(1); }
    }
    @keyframes sparkButton {
        0% { transform: scale(1); box-shadow: 0 0 15px rgba(255,203,105,.8), 0 0 30px rgba(255,160,117,.5); }
        100% { transform: scale(1.02); box-shadow: 0 0 25px rgba(255,203,105,1), 0 0 50px rgba(255,160,117,.8); }
    }


    /* Ù†Ø§ÙØ°Ø© Ø²Ø¬Ø§Ø¬ÙŠØ© Ø¹Ø§Ø¦Ù…Ø© */
    .window{
      position:relative;z-index:10;
      width:min(750px,92vw);
      padding:42px; 
      border-radius:32px;
      background:rgba(255,255,255,.09);
      border:1px solid rgba(255,255,255,.16);
      backdrop-filter:blur(var(--blur));
      box-shadow:0 28px 60px rgba(0,0,0,.45);
      transform-style:preserve-3d;
      animation:floatIn 1.1s ease-out, floating 7.5s ease-in-out infinite;
      text-align:center;
    }
    @keyframes floatIn{from{opacity:0;transform:translateY(54px) rotateX(8deg) rotateY(-5deg)}to{opacity:1;transform:translateY(0) rotateX(0) rotateY(0)}}
    @keyframes floating{0%,100%{transform:translateY(0) rotateZ(0.5deg)}50%{transform:translateY(-10px) rotateZ(-0.5deg)}}

    h1{
      margin:0 0 6px;font-size:38px;font-weight:800;color:var(--gold);
      letter-spacing:.5px;text-shadow:0 0 18px rgba(255,203,105,.55);
    }
    .subtitle{
      margin:0 0 28px;color:var(--light);opacity:.8;font-weight:500;letter-spacing:.6px;
    }
    #message{
      min-height:140px;font-size:22px;line-height:2;color:var(--light);
      transition:color .6s ease,text-shadow .6s ease, transform .6s ease;
    }
    #message.glow{
      text-shadow:0 0 16px rgba(255,203,105,.85), 0 0 4px rgba(255,255,255,.25);
      transform:translateZ(10px);
    }

    /* Ø£Ø²Ø±Ø§Ø± ÙˆØªÙˆÙ‚ÙŠØ¹ ÙˆØ´Ø±Ø§Ø±Ø§Øª */
    .actions{margin-top:26px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap;}
    button{
      padding:14px 26px;border:none;border-radius:50px;cursor:pointer;font-weight:800;
      background:linear-gradient(90deg,#ff9f75,var(--gold));
      color:#1a1a1a;letter-spacing:.4px;
      box-shadow:0 6px 14px rgba(0,0,0,.3);
      transition:transform .25s ease, box-shadow .25s ease, opacity .5s ease;
    }
    button.secondary{background:linear-gradient(90deg, var(--rose), var(--sand));color:#181818;}
    .signature{
      margin-top:20px;font-size:16px; 
      color:var(--gold);font-weight:800;opacity:.85;
      letter-spacing:.8px;text-shadow:0 0 10px rgba(255,203,105,.45);
    }
    footer{margin-top:32px;font-size:14px;color:var(--light);opacity:.6;}
    
    /* Ù†Øµ "ÙØ§ØªÙŠ Ù…Ù„ÙƒØ© Ø§Ù„Ù…Ù„ÙƒØ§Øª" ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© */
    .queen-text{
        position:absolute;z-index:5;
        font-family:'Tajawal',sans-serif;
        font-size:min(18vw, 150px); 
        font-weight:900;
        color:rgba(255,255,255,0);
        text-shadow:0 0 15px rgba(255,203,105,.3);
        letter-spacing:4px;
        pointer-events:none;
        transition:color 2.5s ease-out, text-shadow 2.5s ease-out, opacity 1s ease-out; 
        transform:translate(-50%, -50%) rotate(-5deg);
        white-space:nowrap;
        opacity:0;
        top:50%; left:50%; 
    }
    .queen-text.show{
        opacity:1; 
        color:rgba(255,255,255,.07); 
        text-shadow:0 0 25px rgba(255,203,105,.65), 0 0 5px rgba(255,255,255,.3);
        animation: queenFloating 20s ease-in-out infinite alternate; 
    }

    @keyframes queenFloating {
        0% { transform: translate(-52%, -48%) rotate(-6deg) scale(0.98); }
        100% { transform: translate(-48%, -52%) rotate(6deg) scale(1.02); }
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„ (Mobile Optimization) */
    @media (max-width: 768px) {
        .window {
            padding: 24px; 
            border-radius: 20px; 
        }
        h1 { font-size: 28px; }
        .subtitle { font-size: 14px; margin: 0 0 20px; }
        #message { font-size: 18px; line-height: 1.8; min-height: 100px; }
        .actions { margin-top: 20px; }
        button { padding: 12px 20px; font-size: 14px; }
        .queen-text {
            font-size: 14vw; 
            letter-spacing: 2px;
        }
        #start-overlay h2 { font-size: 32px; }
        #start-overlay p { font-size: 16px; margin-bottom: 30px; }
        #startBtn { font-size: 16px; padding: 14px 28px; }
    }
    
    /* Ø«ÙŠÙ…Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
    .theme-0{background:radial-gradient(circle at 20% 30%, rgba(255,203,105,.25), transparent 40%), linear-gradient(120deg, var(--fassi), var(--teal))}
    .theme-1{background:radial-gradient(circle at 70% 20%, rgba(192,108,132,.24), transparent 45%), linear-gradient(120deg,#361b34,#6b2e4d)}
    .theme-2{background:radial-gradient(circle at 15% 80%, rgba(232,195,158,.28), transparent 45%), linear-gradient(120deg,#3a2f24,#7d5a37)}
    .theme-3{background:radial-gradient(circle at 85% 70%, rgba(140,205,197,.24), transparent 45%), linear-gradient(120deg,#0f1c2b,#1a535c)}
    .theme-4{background:radial-gradient(circle at 50% 50%, rgba(255,160,200,.3), transparent 60%), linear-gradient(120deg, var(--deep-purple), var(--rose))}

    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø´Ø±Ø§Ø±Ø§Øª (Sparks) Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© */
    .spark {
        position: fixed;
        width: 6px;
        height: 6px;
        background: var(--gold);
        border-radius: 50%;
        pointer-events: none;
        z-index: 20;
        opacity: 0;
        transform: translateZ(20px) scale(0);
        animation: sparkMove 1.5s ease-out forwards;
        box-shadow: 0 0 8px var(--gold);
    }
    @keyframes sparkMove {
        0% { opacity: 1; transform: translateZ(20px) scale(1); }
        100% { opacity: 0; transform: translate(var(--dx), var(--dy)) translateZ(20px) scale(0.2); }
    }
  </style>
</head>
<body>
  
  <div id="start-overlay">
    <h2>Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ ÙÙŠ Ù†Ø§ÙØ°ØªÙƒÙ Ø§Ù„Ù…Ø¶ÙŠØ¦Ø© ÙŠØ§ ÙØ§ØªÙŠ âœ¨</h2>
    <p>Ø§Ù†Ù‚Ø±ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„ØªØ¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø§Ù„Ù„Ø¤Ù„Ø¤Ø© ÙˆØªÙƒØªÙ…Ù„ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø³Ù…Ø¹ÙŠØ© ÙˆØ§Ù„Ø¨ØµØ±ÙŠØ©.</p>
    <button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø¢Ù†</button>
  </div>


  <div class="bg-layer theme-0" id="bg"></div>
  <div id="particles-js"></div>

<div class="queen-text" id="queenText">ÙØ§ØªÙŠ Ù…Ù„ÙƒØ© Ø§Ù„Ù…Ù„ÙƒØ§Øª</div>

  <div class="window">
    <h1>Ù†Ø§ÙØ°Ø© ÙØ§ØªÙŠ Ø§Ù„Ù…Ø¶ÙŠØ¦Ø©</h1>
    <p class="subtitle">â€” Ù‡Ø¯ÙŠØ© Ø±Ø§Ù‚ÙŠØ© Ù…Ù† Ø®Ø§Ù„Ø¯ØŒ Ù„Ø¤Ù„Ø¤Ø© ØªØ´Ù‡Ø¯ Ø¹Ù„Ù‰ Ø¬Ù…Ø§Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØªØ¨Ù‚Ù‰ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©</p>

    <p id="message"></p>
    <div class="progress"><div class="bar" id="bar"></div></div>

    <div class="actions">
      <button id="nextBtn">Ø¥Ù„Ù‰ Ø§Ù„Ù„Ø¤Ù„Ø¤Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
      <button class="secondary" id="replayBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¤Ù„Ø¤Ø©</button>
    </div>

    <div class="signature">â€” Ù…Ù† Ø®Ø§Ù„Ø¯ Ø¥Ù„Ù‰ ÙØ§ØªÙŠØŒ Ù„ØªØ¨Ù‚ÙŠÙƒÙ Ù…ØªÙ„Ø£Ù„Ø¦Ø© ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©</div>
    <footer>â€” Ù…ÙƒØ§Ù† ÙŠÙÙ‚Ø¯Ù‘Ø± Ø§Ù„Ø°ÙƒØ§Ø¡ ÙˆØ§Ù„Ø¥Ø´Ø±Ø§Ù‚ ÙˆØ§Ù„Ø¬Ù…Ø§Ù„ Ø§Ù„Ø£ØµÙŠÙ„</footer>
  </div>

  <div class="heart-3d" id="heart"></div>

  <audio id="singleTrack" loop><source src="https://www.dropbox.com/scl/fi/g7bn0z0j0v3tc5iedgscu/a1.mp3.mb3?rlkey=5ntvosotat11wuvj2il7boqsh&st=r3igktyk&dl=1" type="audio/mp3"></audio>


  <script>
    
    // Ø¥Ø²Ø§Ù„Ø© onload="showInitialAlert()" Ù…Ù† <body> ÙˆØ¥Ø²Ø§Ù„Ø© Ø¯Ø§Ù„Ø© showInitialAlert()
    
    /* JavaScript - Ø±Ø³Ø§Ø¦Ù„ ÙˆÙ…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ (Ù„Ø§ ØªØºÙŠÙŠØ±) */
    particlesJS('particles-js',{
      particles:{
        number:{value:85,density:{enable:true,value_area:820}},
        color:{value:"#ffcb69"},
        shape:{type:"circle"},
        opacity:{value:.5},
        size:{value:3,random:true},
        line_linked:{enable:true,distance:150,color:"#1a535c",opacity:.4,width:1},
        move:{enable:true,speed:1.6,random:false,straight:false,out_mode:"out"}
      },
      interactivity:{
        detect_on:"canvas",
        events:{onhover:{enable:true,mode:"grab"},onclick:{enable:true,mode:"push"},resize:true},
        modes:{grab:{distance:140,line_linked:{opacity:1}},push:{particles_nb:4}}
      },
      retina_detect:true
    });

    const messages = [
      { text:"ÙØ§ØªÙŠØŒ Ø£Ù†ØªÙ ÙƒØ§Ù„Ù†ÙˆØ± Ø§Ù„Ù…Ù†Ø¨Ø¹Ø« Ù…Ù† *Ø²Ù„ÙŠØ¬ ÙØ§Ø³* Ø§Ù„Ø¹ØªÙŠÙ‚ØŒ ÙƒÙ„ ØªÙØµÙŠÙ„ ÙÙŠÙƒÙ ÙŠØ­Ù…Ù„ Ø¹Ø¨Ù‚ *Ø§Ù„Ù…ØºØ±Ø¨* ÙˆØ¬Ù…Ø§Ù„Ù‡ Ø§Ù„Ø£ØµÙŠÙ„. Ø°ÙƒØ§Ø¡ÙƒÙ ÙŠÙ„Ù…Ø¹ ÙƒØ§Ù„ÙƒÙˆØ§ÙƒØ¨. âœ¨", theme:0, track:0 },
      { text:"ÙƒØ·Ø§Ù„Ø¨Ø© Ø§Ù‚ØªØµØ§Ø¯ØŒ Ø£Ù†ØªÙ ØªÙÙ‡Ù…ÙŠÙ† Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù†Ø§Ø¯Ø±Ø©. ÙˆØ£Ù†ØªÙ *Ø£Ø«Ù…Ù† Ø£ØµÙˆÙ„ÙŠ*ØŒ Ù…Ø¹Ø§Ø¯Ù„Ø© ØµØ¹Ø¨Ø© Ù„ÙƒÙ†Ù‡Ø§ Ø§Ù„Ø£Ø¬Ù…Ù„. Ø´ØºÙÙƒÙ Ù„Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ ÙŠÙ„Ù‡Ù…Ù†ÙŠ. ğŸ“ˆ", theme:1, track:0 }, 
      { text:"Ø£ÙŠÙ†Ù…Ø§ Ø­Ù„Ù„ØªÙØŒ ÙŠÙ†Ø¨Ø¶ Ø§Ù„Ø¯ÙØ¡. Ø¥Ù† Ù‚Ù„Ø¨ÙƒÙ Ø­Ù†ÙˆÙ† ÙƒØ·Ø¹Ù… *Ø§Ù„ÙƒØ³ÙƒØ³* Ø§Ù„Ø°ÙŠ ØªØ¹Ø¯Ù‘Ù‡ Ø§Ù„ÙŠØ¯ Ø§Ù„Ù…ØºØ±Ø¨ÙŠØ© Ø¨Ø­Ø¨Ù‘ØŒ ÙŠØ¬Ù…Ø¹ Ø§Ù„Ø£Ù‡Ù„ ÙˆÙŠØ­ÙƒÙŠ Ù‚ØµØµÙ‹Ø§. ğŸ²", theme:2, track:0 }, 
      { text:"Ø§Ù„Ø­ÙŠØ§Ø© ØªØ¬Ø±Ø¨Ø©ØŒ ÙˆØ£Ù†ØªÙ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ÙƒØ«Ø± Ø¥Ø´Ø±Ø§Ù‚Ù‹Ø§ ÙÙŠÙ‡Ø§. ØªØ°ÙƒØ±ÙŠ Ø£Ù† Ø§Ù„Ù‚ÙˆØ© Ù„Ø§ ØªÙƒÙ…Ù† ÙÙŠ Ø§Ù„Ø¸Ø±ÙˆÙØŒ Ø¨Ù„ ÙÙŠ Ù…Ø±ÙˆÙ†Ø© Ù‚Ù„Ø¨ÙƒÙ ÙˆØ«Ø¨Ø§Øª Ø¹Ù‚Ù„ÙƒÙ. ğŸŒ¹", theme:3, track:0 }, 
      { text:"*Ø§Ù„Ø®Ø§ØªÙ…Ø©:* Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„Ù† ØªÙ†ØºÙ„Ù‚. Ø³ØªØ¨Ù‚Ù‰ ÙØ§ØªØ­Ø© Ø¹Ù„Ù‰ Ù‚Ù†Ø§Ø¹Ø© Ø¨Ø£Ù† Ø¨ØµÙ…ØªÙƒÙ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù„Ù… ÙØ±ÙŠØ¯Ø© ÙˆÙ„Ø§ ØªÙØ¹ÙˆØ¶. *Ù…Ø³ØªÙ‚Ø¨Ù„ÙƒÙ ÙŠØ³ØªØ­Ù‚ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø´Ø±Ø§Ù‚ ÙˆÙ‡Ø°Ù‡ Ø§Ù„Ø¹Ø¸Ù…Ø©.* ğŸ’¡", theme:4, track:0 } 
    ];

    /* Ø¹Ù†Ø§ØµØ± DOM */
    const messageEl = document.getElementById('message');
    const bgEl = document.getElementById('bg');
    const nextBtn = document.getElementById('nextBtn');
    const replayBtn = document.getElementById('replayBtn');
    const barEl = document.getElementById('bar');
    const heartEl = document.getElementById('heart');
    const queenTextEl = document.getElementById('queenText'); 
    
    // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const startOverlayEl = document.getElementById('start-overlay');
    const startBtnEl = document.getElementById('startBtn');

    // âœ… Ø§Ù„Ø¢Ù† ÙŠØªÙ… Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø¥Ù„Ù‰ Ø£ØºÙ†ÙŠØ© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
    const singleTrack = document.getElementById('singleTrack');
    const tracks = [
      singleTrack, 
      singleTrack, 
      singleTrack, 
      singleTrack, 
      singleTrack
    ];

    let idx = 0;
    let typingTimer = null;
    let audioCurrent = null;
    let hasInteracted = false; 

    /* Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ù„ØªØ¨Ø¯ÙŠÙ„ */
    function typeMessage(text, onDone){
      clearTimeout(typingTimer);
      messageEl.classList.remove('glow');
      messageEl.textContent = '';
      barEl.style.width = '0%';
      const total = text.length;
      let i = 0;
      (function step(){
        if(i < total){
          messageEl.textContent += text.charAt(i);
          barEl.style.width = ((i/total)*100).toFixed(2) + '%';
          i++;
          typingTimer = setTimeout(step, 34);  
        }else{
          messageEl.classList.add('glow');
          burstSparks(); 
          onDone && onDone();
        }
      })();
    }

    function setTheme(themeIndex){
      bgEl.className = 'bg-layer theme-' + themeIndex;
      bgEl.style.opacity = .22;
      bgEl.style.filter = 'saturate(1.1) contrast(1.08) hue-rotate(' + (themeIndex*14) + 'deg)';
    }

    async function playTrack(trackIndex){
      if (!hasInteracted) return; 
      
      const audio = singleTrack; 
      if(audioCurrent && !audioCurrent.paused && audioCurrent !== audio){
        await fadeOut(audioCurrent, 800);
        audioCurrent.pause();
      }
      
      if(audio.paused){
          audio.volume = 0;
          try{
            await audio.play(); 
            audioCurrent = audio;
            fadeIn(audio, 1400);
          }catch(e){
            console.error("Audio playback error: Could not load the online file.", e);
             console.warn("âš  ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§ØªØµØ§Ù„ Ø´Ø¨ÙƒØ© Ù‚ÙˆÙŠØ© ÙˆØ£Ù† Ø±Ø§Ø¨Ø· Dropbox Ù„Ø§ ÙŠØ²Ø§Ù„ ÙŠØ¹Ù…Ù„.");
          }
      } else {
        audioCurrent = audio;
      }
    }

    function fadeIn(audio, duration=1200){
      const steps = 12; const maxVolume = 0.6; 
      const step = maxVolume/steps; let v = audio.volume;
      const iv = setInterval(()=>{
        v += step; audio.volume = Math.min(maxVolume, v);
        if(v >= maxVolume) clearInterval(iv);
      }, duration/steps);
    }

    function fadeOut(audio, duration=800){
      return new Promise(resolve=>{
        const steps = 10; const step = audio.volume/steps; let v = audio.volume;
        const iv = setInterval(()=>{
          v -= step; audio.volume = Math.max(0, v);
          if(v <= 0){ clearInterval(iv); resolve(); }
        }, duration/steps);
      });
    }

    function burstSparks(){
      const rect = messageEl.getBoundingClientRect();
      const centerX = rect.left + rect.width/2;
      const centerY = rect.top + rect.height/2;
      Array.from({length:14}).forEach(()=>{
        const s = document.createElement('div');
        s.className = 'spark';
        const dx = (Math.random()*180 - 90) + 'px';
        const dy = (Math.random()*90 - 45) + 'px';
        s.style.setProperty('--dx', dx);
        s.style.setProperty('--dy', dy);
        s.style.left = (centerX + (Math.random()*40 - 20)) + 'px';
        s.style.top  = (centerY + (Math.random()*20 - 10)) + 'px';
        document.body.appendChild(s);
        s.addEventListener('animationend', ()=>s.remove());
      });
    }

    function maybeShowHeart(){
      if(idx === messages.length - 1){ 
        // Ø§ÙØªØ±Ø¶ Ø£Ù† Ù„Ø¯ÙŠÙƒ ØªÙ†Ø³ÙŠÙ‚ CSS Ù„Ù€ #heart.show
        // heartEl.classList.add('show');
        // setTimeout(()=> heartEl.classList.remove('show'), 8000);
      }
    }

    function toggleQueenText(show){
        if(show){
            queenTextEl.classList.add('show');
        } else {
            queenTextEl.classList.remove('show');
        }
    }
    
    function runScene(sceneIndex){
      // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù€ idx Ø§Ù„ØµØ­ÙŠØ­
      if (sceneIndex < 0 || sceneIndex >= messages.length) sceneIndex = 0;

      const scene = messages[sceneIndex];
      const isLastScene = (sceneIndex === messages.length - 1);

      nextBtn.style.opacity = isLastScene ? '0' : '1';
      nextBtn.style.pointerEvents = isLastScene ? 'none' : 'auto';
      replayBtn.style.opacity = '0'; 
      replayBtn.style.pointerEvents = 'none';

      toggleQueenText(false); 

      setTheme(scene.theme);
      // ØªØ£ÙƒØ¯ Ø£Ù† playTrack ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø£ÙˆÙ„
      if (hasInteracted) playTrack(scene.track);
      
      typeMessage(scene.text, ()=>{
        if(!isLastScene) { 
             nextBtn.style.opacity = '1'; 
             nextBtn.style.pointerEvents = 'auto';
        } else {
             toggleQueenText(true); 
        }
        replayBtn.style.opacity = '1'; 
        replayBtn.style.pointerEvents = 'auto';
        maybeShowHeart();
      });
      
    }
    
    // Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ ÙƒÙ„ Ø´ÙŠØ¡
    function handleFirstInteraction(){
      if(!hasInteracted){
        hasInteracted = true;
        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
        startOverlayEl.classList.add('hidden');
        // Ø¨Ø¯Ø¡ Ø£ÙˆÙ„ Ø±Ø³Ø§Ù„Ø© (ÙˆÙ‡ÙŠ Ø§Ù„ØªÙŠ Ø³ØªØ¨Ø¯Ø£ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¹Ø¨Ø± playTrack Ø¨Ø¯Ø§Ø®Ù„Ù‡Ø§)
        runScene(idx);
      }
    }


    /* Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¨Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    document.addEventListener('DOMContentLoaded', ()=>{
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø£ÙˆÙ„ (Ù„ÙƒÙ†Ù‡ Ù„Ù† ÙŠØ¨Ø¯Ø£ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙˆÙ„Ø§ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰)
        // runScene(0) Ù„Ù… ÙŠØ¹Ø¯ Ù…Ø·Ù„ÙˆØ¨Ù‹Ø§ Ù‡Ù†Ø§ Ù„Ø£Ù†Ù‡ Ø³ÙŠØ¨Ø¯Ø£ ÙÙŠ handleFirstInteraction()
        
        // Ø±Ø¨Ø· Ø²Ø± "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø¢Ù†" Ø¨ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø£ÙˆÙ„
        startBtnEl.addEventListener('click', handleFirstInteraction);
        
        nextBtn.addEventListener('click', ()=>{
          idx = (idx + 1) % messages.length;
          runScene(idx);
        });

        replayBtn.addEventListener('click', ()=>{
          // Ù„Ø§ Ù†ØºÙŠØ± idx Ù‡Ù†Ø§ØŒ ÙÙ‚Ø· Ù†Ø¹ÙŠØ¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
          runScene(idx);
        });

        // Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        nextBtn.style.opacity = '0';
        nextBtn.style.pointerEvents = 'none';
        replayBtn.style.opacity = '0';
        replayBtn.style.pointerEvents = 'none';
        
    });
  </script>
</body>
</html>
